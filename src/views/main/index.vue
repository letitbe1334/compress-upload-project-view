<template>
  <div class="main-container">
    <!-- ì œëª© -->
    <h2>ğŸ“¸ ì´ë¯¸ì§€ íŒŒì¼ ì••ì¶•</h2>
    <div class="main-description">
      ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ ì‹œì— ìš©ëŸ‰ ë¬¸ì œë¥¼ í•´ê²°í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ ì‹œí‚¤ê³  ì„œë²„ ìš©ëŸ‰ ë¶€ë‹´ì„ ë‚®ì¶”ëŠ” ê²ƒì´ ëª©í‘œ
    </div>
    <!-- ë™ê¸° -->
    <OrderContainer :title="motive.title" :items="motive.items" />
    <!-- ì‚¬ìš©ê¸°ìˆ  -->
    <div>
      <img src="https://img.shields.io/badge/Vue-3.5.18-%234FC08D?logo=vuedotjs" alt="vue" />
      <img src="https://img.shields.io/badge/Quasar-2.17.0-blue?logo=quasar" alt="quasar" />
      <img src="https://img.shields.io/badge/Compressorjs-1.2.1-orange" alt="compressorjs" />
    </div>
    <!-- asis / tobe ë¹„êµ -->
    <CardContainer 
      :title="asistobe.title"
      :items="asistobe.items"
    />
    <!-- ê²°ê³¼ ë¹„êµ -->
    <CardContainer 
      :title="resultCompare.title"
      :items="resultCompare.items"
    />
    <CardContainer 
      :title="improve.title"
      :items="improve.items"
    />
    <!-- ì´í‰ -->
    <!-- <UploadBefore :attachInfo="attachBefore" label="ì´ì „" /> -->
    <!-- <UploadAfter :attachInfo="attachAfter"  label="ì´í›„" /> -->
  </div>
</template>
<script setup lang="ts">

/******************************
 * #Important ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¡œì§, ë³€ìˆ˜ ë“± ì„ ì–¸ X
 *******************************/

/******************************
 * @import_ì„ ì–¸
 * TODO ì•„ë˜ ìˆœì„œì— ë§ì¶”ì–´ import (ê° ìˆœì„œ ë§ˆë‹¤ ë„ìš°ê¸°)
 *  * 1. Dependency
 *  * 2. Utils
 *  * 3. Types
 *  * 4. Stores
 *  * 5. Vue
 *  * 6. Etc (ìƒê¸¸ ì‹œ ì–˜ê¸°.)
 *******************************/

/******************************
 * @ì»´í¬ë„ŒíŠ¸_ì˜µì…˜_ì„ ì–¸
 * TODO ì´ë¦„ ì •ì˜ (íŒŒì¼ ì´ë¦„ ê·¸ëŒ€ë¡œ ì§€ì •)
 *******************************/
defineOptions({
  name: 'mainIndex'
})

/******************************
 * @Pinia_store_ì„ ì–¸
 * TODO ë°˜ì‘í˜• ìœ ì§€ë¥¼ ìœ„í•´ storeToRefs ì‚¬ìš© (functionì€ ì‚¬ìš© X)
 *******************************/
/******************************
 * @Emit_ì„ ì–¸
 *******************************/

/******************************
 * @Vue_ê´€ë ¨_ì„ ì–¸ (ex. vue-router)
 *******************************/

/******************************
 * @Interface_ì„ ì–¸
 *******************************/

/******************************
 * @inject_ì„ ì–¸
 *******************************/

/******************************
 * @Props_ì„ ì–¸
 * TODO type & default ì‘ì„±
 *******************************/

/******************************
 * @VModel_ì„ ì–¸
 *******************************/

/******************************
 * @Data_ì„ ì–¸
 * TODO ref, reactive ì‚¬ìš©, ë¶ˆëª…í™•í•œ ë‹¨ì–´ ì‚¬ìš© X (ex. data, date)
 *******************************/
const motive = ref({
  title: 'ğŸ”¥ ì´ì™€ ê°™ì€ ì‘ì—…ì„ í•˜ê²Œëœ ë™ê¸°!!',
  items: [
    'ì›¹ì•±ì„ í†µí•´ ì‚¬ì§„ì„ í˜„ì”ì—ì„œ ì°ê³  í•˜ëŠ” ì¼ë“¤ì´ ë§ì´ ë°œìƒí•¨',
    'ìš”ì¦˜ ìŠ¤ë§ˆíŠ¸í°ì˜ í™”ì§ˆì´ ì¢‹ì•„ì§ì— ë”°ë¼ ì‚¬ì§„ ìš©ëŸ‰ì´ í¼',
    '1. í•˜ë£¨ì— ìˆ˜ë°±ì¥ì´ ìŒ“ì´ë‹¤ë³´ë‹ˆ ì„œë²„ ìš©ëŸ‰ ë¶€ë‹´ì´ ë°œìƒ<br/>2. ì°íŒ ì‚¬ì§„ì„ ì›¹ì—ì„œ ë³´ì—¬ì£¼ë ¤í• ë•Œ loadë˜ëŠ” ì‹œê°„ì´ ê¸¸ì–´ì§€ê²Œ ë¨',
    'ì‚¬ì§„ì„ ì••ì¶•ì‹œì¼œ ìš©ëŸ‰ì„ ë–¨ì–´íŠ¸ë¦¼',
    'ì‚¬ì§„ì´ ê³ í™”ì§ˆì¼ í•„ìš”ê°€ ì—†ìŒ (ë”°ë¼ì„œ ê³ í™”ì§ˆ ì‚¬ì§„ì„ ë”°ë¡œ ì €ì¥í•˜ê±°ë‚˜ í•˜ì§€ ì•ŠìŒ)',
    '1. ì„œë²„ ìš©ëŸ‰ì— ëŒ€í•œ ë¶€ë‹´ê°ì´ ë‚®ì•„ì§ <br/>2. ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ë¹¨ë¼ì§€ê²Œ ë¨',
  ]
})
const asistobe = ref({
  title: 'ğŸ” ì´ë¯¸ì§€ ì••ì¶• ì—…ë¡œë“œ ìˆœì„œ ë¹„êµ',
  items: [
    { 
      headerContents: 'ì‚¬ìš©ìê°€ íŒŒì¼ì„ ì²¨ë¶€', 
      haveContents: false,
    },
    { 
      headerContents: 'reject file ì²´í¬', 
      haveContents: true,
      asisContents: [
        { 
          laguageType: 'javascript',
          description: 'ì—…ë¡œë“œ ì¤€ë¹„ ì¤‘ì¸ íŒŒì¼ì´ ê±°ë¶€ë˜ëŠ” ì¡°ê±´ì— ë¶€í•©ë˜ëŠ” ê²½ìš° rejected methodì— ê±¸ë ¤ ì›ì¸ì„ ì•Œë¦¼ì°½ìœ¼ë¡œ noti í•´ìš”.',
          contents: `/******************************
 * TODO (ëª©ì ): ì—…ë¡œë“œí•  íŒŒì¼ ê±°ë¶€
 * @param (1): ê±°ë¶€ëœ ì •ë³´
 *******************************/
function rejected(info: any) {
  if (!info || info.length === 0) {
    return
  }
  let message = ''
  _.forEach(info, (reject) => {
    // accept, max-file-size, max-total-size, filter, etc
    switch (reject.failedPropValidation) {
      case 'max-file-size': // íŒŒì¼ìš©ëŸ‰ ì´ˆê³¼
      case 'max-total-size': // íŒŒì¼ ì „ì²´ ìš©ëŸ‰ ì´ˆê³¼
        message +=
          $language('ì²¨ë¶€í•˜ì‹  íŒŒì¼ì˜ ìš©ëŸ‰ì´ ì§€ì •ëœ ìš©ëŸ‰ë³´ë‹¤ í½ë‹ˆë‹¤. íŒŒì¼ ìš©ëŸ‰ : ') +
          '(' +
          getFileSizeTextByRound(reject.file.size) +
          ')'
        break
      case 'max-files': // ì—…ë¡œë“œ ê°¯ìˆ˜ ì´ˆê³¼
        message =
          $language('ì²¨ë¶€í•˜ì‹  íŒŒì¼ì˜ ì§€ì •ëœ ì—…ë¡œë“œ ê°¯ìˆ˜ë¥¼ ì´ˆê³¼í•˜ì—¬ ì—…ë¡œë“œ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.') +
          '(' +
          uploaderSetting.value.limitCnt +
          ')'
        break
      case 'accept': // í™•ì¥ì ë§ì§€ì•ŠìŒ
        message =
          $language('ì²¨ë¶€í•˜ì‹  íŒŒì¼ì˜ í™•ì¥ìê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.') +
          '(' +
          uploaderSetting.value.acceptExt +
          ')'
        break
      case 'filter': // filter ê±¸ë¦°ê²½ìš°
        // í•´ë‹¹ ê¸°ëŠ¥ ì‚¬ìš©í•˜ì§€ ì•ŠìŒìœ¼ë¡œ ë‹¤êµ­ì–´ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
        message =
          'ì²¨ë¶€í•˜ì‹  ì´ë¯¸ì§€ "' +
          reject.file.name +
          '"ì˜ ì‚¬ì´ì¦ˆê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì‚¬ì´ì¦ˆ : ' +
          props.imageRestriction.width +
          ' X ' +
          props.imageRestriction.height +
          ')'
        break
      default:
        break
    }
  })
  $q.notify({
    color: 'negative',
    html: true,
    message: message,
    multiLine: true,
    timeout: 5000
  })
}`
        }
      ],
      tobeContents: [],
      isSame: true
    },
    { 
      headerContents: 'ì¶”ê°€ëœ íŒŒì¼ ì—…ë¡œë“œ', 
      haveContents: true,
      // 'auto-upload, url, header, method, form-fieldsë¥¼ í†µí•´ ìë™ ì—…ë¡œë“œ ë¨ìœ¼ë¡œ í‘œì‹œ',
      asisContents: [
        { 
          laguageType: 'html', 
          description: 'Quasarì—ì„œ ì œê³µí•˜ëŠ” uploader ì»´í¬ë„ŒíŠ¸ë¥¼ ì´ìš©í–ˆì–´ìš”.<br/>íŒŒì¼ì„ ì¶”ê°€í•˜ë©´ API serverì— ë°”ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ì†ì„±ì„ ì •ì˜í–ˆì–´ìš”.',
          contents: `<q-uploader
  with-credentials
  ref="customUpload"
  field-name="file"
  :url="url"
  :headers="headers"
  method="POST"
  :form-fields="formFields"
  :auto-upload="true"
  @finish="finish"
  @failed="failed"
  @rejected="rejected"
/>` 
        },
        { 
          laguageType: 'javascript', 
          description: 'API serverì— ë°”ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ì •ì˜í•œ ì†ì„±ì€ ë‹¤ìŒê³¼ ê°™ì•„ìš”.',
          contents: `const url = computed(
  () => import.meta.env.VITE_API_URL + transactionConfig.com.upload.uploading.url
)
const headers = computed(() => [{ name: 'Authorization', value: accessToken.value }, { name: 'withCredentials', value: 'true' }])
const formFields = computed(() => {
  const data = [
    {
      name: 'regId',
      value: user.value.userId
    },
    {
      name: 'modId',
      value: user.value.userId
    }
  ]
  if (props.attachInfo) {
    if (props.attachInfo.taskClassCd) {
      data.push({
        name: 'taskClassCd',
        value: props.attachInfo.taskClassCd
      })
    }
    /**
     * ì‹ ê·œì¸ ê²½ìš° taskKeyê°€ ì—†ì„ ìˆ˜ ìˆìŒ
     * í•´ë‹¹ì˜ ê²½ìš° api-serverì—ì„œ ìœ ë‹ˆí¬í•œ idë¥¼ ìƒì„±í•˜ì—¬ ì €ì¥ í›„ ë°˜í™˜í•œë‹¤.
     */
    if (props.attachInfo.taskKey) {
      data.push({
        name: 'taskKey',
        value: props.attachInfo.taskKey
      })
    } else {
      const val = props.attachInfo.taskClassCd + '_' + uid()
      data.push({
        name: 'taskKey',
        value: val
      })
    }
  }
  return data
})` 
        },
      ],
      // 'added method ì¶”ê°€, ì••ì¶• ì§„í–‰í•˜ëŠ” methodë“¤ ë³´ì—¬ì£¼ê¸°',
      tobeContents: [
        {
          laguageType: 'html', 
          description: 'API serverì— ë°”ë¡œ ìš”ì²­ ë³´ë‚´ê¸°ì „ì— ì••ì¶•ì„ ì§„í–‰í•  ê±°ì˜ˆìš”.<br/>ê·¸ë˜ì„œ ğŸ”ë³€ê²½ë˜ê³ , â•ì¶”ê°€ëœ ì†ì„±ì´ ìˆì–´ìš”.',
          contents: `<q-uploader
  with-credentials
  ref="customUpload"
  field-name="file"
  :url="url"
  :headers="headers"
  method="POST"
  :form-fields="formFields"
  :auto-upload="false" ğŸ”ë³€ê²½
  @added="added" â•ì¶”ê°€
  @finish="finish"
  @failed="failed"
  @rejected="rejected"
/>`
        },
        {
          laguageType: 'javascript', 
          description: 'íŒŒì¼ ì••ì¶•ì„ ìœ„í•œ ìƒíƒœë¥¼ ì •ì˜í•´ìš”.',
          contents: `/** íŒŒì¼ ì••ì¶• */
const queueFileInfo = ref<queueFileInfoType>({
  files: [],
  compressFiles: [],
  len: 0,
  isStart: false,
  isUpload: false
})
/** compressor Data */
const options = ref<Compressor.Options>({
  strict: true,
  checkOrientation: true,
  maxWidth: 600,
  maxHeight: undefined,
  minWidth: 0,
  minHeight: 0,
  width: undefined,
  height: undefined,
  resize: 'contain', // none contain cover
  quality: 0.1,
  mimeType: '',
  convertTypes: 'image/png',
  convertSize: 5000000,
  success: () => {},
  error: () => {}
})
/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì••ì¶• ì˜µì…˜ ì…‹íŒ…
 *******************************/
function setCompressOptions() {
  options.value.success = successCompress
  options.value.error = errorCompress
}
/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì••ì¶• ì„±ê³µ
 * @param (1): ì••ì¶• ì„±ê³µí•œ íŒŒì¼ ì •ë³´
 *******************************/
function successCompress(result: any) {
  if (!queueFileInfo.value.compressFiles) queueFileInfo.value.compressFiles = []
  queueFileInfo.value.compressFiles.push(result)
  queueLenMi()
}
/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì••ì¶• ì‹¤íŒ¨
 * @param (1): ì‹¤íŒ¨ ì •ë³´
 *******************************/
function errorCompress(err: any) {
  console.log(err)
}`
        },
        {
          laguageType: 'javascript', 
          description: 'ì—…ë¡œë“œí•  íŒŒì¼ì´ ì¶”ê°€ë˜ë©´ ì¶”ê°€ëœ íŒŒì¼ë“¤ì„ ì••ì¶•ì„ ì‹œì¼œìš”.<br/>ì••ì¶•ì´ ëë‚˜ë©´ API serverë¡œ q-uploaderì— ì••ì¶•ëœ íŒŒì¼ì„ ì¶”ê°€í•´ upload ìš”ì²­ì„ ë³´ë‚´ê²Œ í•´ìš”.',
          contents: `/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì¶”ê°€, ì¶”ê°€í•˜ëŠ” ë™ì‹œì— íŒŒì¼ ì••ì¶•ì§„í–‰
 * @param (1): ì¶”ê°€í•œ íŒŒì¼ë“¤
 *******************************/
function added(files: readonly any[]) {
  if (queueFileInfo.value.isUpload) return
  compressCheck(files, uploaderSetting.value)
}
/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì••ì¶• ì²´í¬
 * @param (1): ì••ì¶•í•  íŒŒì¼ë“¤
 * @param (2): ì••ì¶• ì…‹íŒ…ì •ë³´
 *******************************/
function compressCheck(files: readonly any[], uploadSetting: any) {
  if (files && files.length > 0) {
    _.extend(queueFileInfo.value.files, files)
    queueFileInfo.value.compressFiles = []
    queueFileInfo.value.isStart = true
    if (uploadSetting) {
      if (uploadSetting.resizeWidth === 0) {
        options.value.maxWidth = undefined
        options.value.quality = 1
      } else {
        options.value.maxWidth = uploadSetting.resizeWidth
        options.value.quality = uploadSetting.resizeQuality
      }
    }
    // ì´ë¯¸ì§€ íŒŒì¼ì„ í¬í•¨í•œ ëª¨ë“  íŒŒì¼ì˜ ê°¯ìˆ˜
    queueFileInfo.value.len = files.length
    _.forEach(queueFileInfo.value.files, (_file) => {
      compress(_file)
    })
  }
}
/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì••ì¶•
 * @param (1): ì••ì¶•í•  íŒŒì¼
 *******************************/
function compress(file: any) {
  if (!file) {
    return
  }
  const reg = /(gif|jpe?g|tiff?|png|webp|bmp)$/g
  const _check = reg.test(file.type)
  if (_check) {
    new Compressor(file, options.value)
    // ì´ë¯¸ì§€
  } else {
    if (!queueFileInfo.value.compressFiles) queueFileInfo.value.compressFiles = []
    queueFileInfo.value.compressFiles.push(file)
    queueLenMi()
  }
}
/******************************
 * TODO (ëª©ì ): ì••ì¶•ëœ íŒŒì¼ API ì„œë²„ì— ì €ì¥ ìš”
 *******************************/
function queueLenMi() {
  queueFileInfo.value.len = queueFileInfo.value.len - 1

  if (queueFileInfo.value.isStart && queueFileInfo.value.len === 0) {
    customUpload.value.removequeueFiles()
    queueFileInfo.value.isUpload = true
    setTimeout(() => {
      customUpload.value.addFiles(queueFileInfo.value.compressFiles)

      customUpload.value.upload()
    }, 500)
  }
}`
        },
      ]
    },
    { 
      headerContents: 'API server ì €ì¥ ì‹¤íŒ¨í•œ ê²½ìš°', 
      haveContents: true,
      asisContents: [
        { 
          laguageType: 'javascript', 
          description: 'ì—…ë¡œë“œê°€ ì‹¤íŒ¨í•˜ê²Œ ë˜ë©´ ì‹¤íŒ¨í•œ íŒŒì¼ì •ë³´ë¥¼ ì•Œë¦¼ì°½ì„ í†µí•´ notií•´ìš”.',
          contents: `/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨
 * @param (1): ì‹¤íŒ¨ ì •ë³´
 *******************************/
function failed(info: any) {
  let message = ''
  if (info && info.files && info.files.length > 0) {
    message = '['
    let idx = 0
    _.forEach(info.files, (file) => {
      message += '"' + file.name + (idx !== info.files.length - 1 ? '", ' : '"] ')
      idx++
    })
    message += $language('ì—…ë¡œë“œì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.')
  }
  $q.notify({
    color: 'negative',
    html: true,
    message: message,
    multiLine: true,
    timeout: 5000
  })
}`
        }
      ],
      tobeContents: [],
      isSame: true
    },
    { 
      headerContents: 'ì—…ë¡œë“œ ì¢…ë£Œ', 
      haveContents: true,
      asisContents: [
        {
          laguageType: 'javascript', 
          description: 'ì—…ë¡œë“œê°€ ëë‚˜ê²Œë˜ë©´(ì‹¤íŒ¨/ì„±ê³µ) ì—…ë¡œë“œ ëœ íŒŒì¼ì„ ë¹„ì›Œì£¼ê³  ë¦¬ì…‹í•´ìš”.<br/>ê·¸ëŸ¬ê³  ë‚œ ë‹¤ìŒ ì €ì¥ëœ íŒŒì¼ ì •ë³´ë¥¼ ì¡°íšŒí•´ì„œ ì‚¬ìš©ìê°€ íŒŒì¼ë“¤ì„ ë³¼ ìˆ˜ ìˆê²Œ í•´ìš”.',
          contents: `/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì—…ë¡œë“œ ì¢…ë£Œ
 *******************************/
function finish() {
  customUpload.value.removeUploadedFiles()
  customUpload.value.reset()
  getUploadedFiles() // ì €ì¥ëœ íŒŒì¼ì •ë³´ ì¡°íšŒ
}`
        }
      ],
      tobeContents: [
        {
          laguageType: 'javascript', 
          description: 'ì—…ë¡œë“œ ëœ íŒŒì¼ì„ ë¹„ì›Œì£¼ê³  ë¦¬ì…‹í•˜ëŠ” ê³¼ì •ì—ì„œ ì••ì¶•ì„ ìœ„í•´ ê´€ë¦¬í•œ ìƒíƒœë“¤ë„ ë¦¬ì…‹í•˜ëŠ” method callì„ ì¶”ê°€í•´ì¤˜ìš”.',
          contents: `/******************************
 * TODO (ëª©ì ): íŒŒì¼ ì—…ë¡œë“œ ì¢…ë£Œ
 *******************************/
function finish() {
  customUpload.value.removeUploadedFiles()
  customUpload.value.reset()
  reset() // â• ì¶”ê°€
  getUploadedFiles() // ì €ì¥ëœ íŒŒì¼ì •ë³´ ì¡°íšŒ
}
/******************************
 * TODO (ëª©ì ): ì••ì¶•íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ëª©ë¡ ì´ˆê¸°í™”
 *******************************/
function reset() {
  queueFileInfo.value.files = []
  queueFileInfo.value.compressFiles = []
  queueFileInfo.value.len = 0
  queueFileInfo.value.isStart = false
  queueFileInfo.value.isUpload = false
}`
        }
      ],
    }
  ]
})
const resultCompare = ref({
  title: 'ğŸ‘€ ì´ë¯¸ì§€ ì••ì¶• ê²°ê³¼ ë¹„êµ',
  items: [
    { 
      headerContents: 'ì—…ë¡œë“œ ëœ ì‚¬ì§„íŒŒì¼ ë°ì´í„° ë¹„êµ', 
      haveContents: true,
      isAggregated: true,
      aggregateContents: [
        { 
          laguageType: 'image',
          description: 'BEFOREì™€ AFTER ë°ì´í„°(task_class_cd)ë¥¼ ë³´ê²Œ ë˜ë©´ ì••ì¶• ì „ í›„ì— ëŒ€í•œ ì €ì¥ëœ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”.<br/>ì‚¬ì´ì¦ˆë¥¼ ë³´ê²Œ ë˜ë©´ 463ë°° ì •ë„ ìš©ëŸ‰ì´ ì‘ì•„ì§„ ê±¸ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.',
          contents: new URL('@/assets/images/compare/ë°ì´í„° ë¹„êµ.png', import.meta.url).href
        },
        { 
          laguageType: 'image',
          contents: new URL('@/assets/images/compare/afterbefore_ì†ì„±ì°½.png', import.meta.url).href
        }
      ],
    },
    { 
      headerContents: 'ì‚¬ì§„ í™”ì§ˆ ë¹„êµ', 
      haveContents: true,
      isAggregated: true,
      aggregateContents: [
        { 
          laguageType: 'image',
          description: 'ê³ í™”ì§ˆì´ ì•„ë‹ˆì—¬ë„ ëœë‹¤ê³  í–ˆì§€ë§Œ ì‹ë³„ì´ ê°€ëŠ¥í•´ì•¼ í•´ìš”. ì••ì¶• ì „(ì™¼ìª½) / í›„(ì˜¤ë¥¸ìª½) ì‚¬ì§„ì„ ë³´ë©´ì„œ í™”ì§ˆì´ ë‚®ì•„ì¡Œì§€ë§Œ ê³ ê°ì´ ì¸ì‹/ìˆ˜ê¸ í•  ìˆ˜ ìˆëŠ” ë²”ìœ„ê¹Œì§€ ë–¨ì–´íŠ¸ë ¤ íš¨ìœ¨ì„ ì±™ê²¼ì–´ìš”.',
          contents: new URL('@/assets/images/compare/í™”ì§ˆ ë¹„êµ ì‚¬ì§„.png', import.meta.url).href
        },
      ],
    },
    { 
      headerContents: 'Axios ìš”ì²­/ì‘ë‹µ ì‹œê°„ ë¹„êµ', 
      haveContents: true,
      isAggregated: true,
      aggregateContents: [
        { 
          laguageType: 'image',
          description: 'Request sentì‹œê°„ì„ ë³´ê²Œ ë˜ë©´ 189.20ms â¡ï¸ 0.49msë¡œ 386ë°°ë‚˜ ì°¨ì´ë‚˜ê³  ìˆëŠ”ê±¸ ë³¼ ìˆ˜ ìˆì–´ìš”.<br/>API serverì—ì„œë„ íŒŒì¼ì„ ë¬¼ë¦¬ì ìœ¼ë¡œ ì €ì¥í•˜ê¸° ìœ„í•´ ì‹œê°„ì´ ì†Œë¹„ë  ê²ë‹ˆë‹¤.<br/>Waiting for server reponseë¥¼ ë³´ê²Œ ë˜ë©´ 329.74ms â¡ï¸ 122.26msë¡œ 2.6ë°° ì°¨ì´ê°€ ë‚˜ëŠ”ê±¸ í™•ì¸ í•  ìˆ˜ ìˆì–´ìš”.',
          contents: new URL('@/assets/images/compare/axios ìš”ì²­ ì‘ë‹µ ì‹œê°„ ë¹„êµ.png', import.meta.url).href
        },
      ],
    },
  ]
})
const improve = ref({
  title: 'ğŸ¤” ë‹¤ë¥¸ ë°©ì•ˆì€ ì—†ì„ê¹Œ?',
  items: [
    { 
      headerContents: 'ê³ í™”ì§ˆì„ ì›í•œë‹¤ë©´ ì´ë¯¸ì§€ í¬ë§· ìµœì í™”ë¥¼ ê³ ë ¤í•´ ë³¼ ìˆ˜ ìˆì–´ìš”.', 
      haveContents: true,
      isAggregated: true,
      aggregateContents: [
        { 
          laguageType: 'html',
          description: 'WebP ë˜ëŠ” AVIF í¬ë§·ìœ¼ë¡œ ë³€í™˜í•´ì„œ ì´ë¯¸ì§€ í’ˆì§ˆì€ ìœ ì§€í•˜ë©´ì„œ íŒŒì¼ ìš©ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆì–´ìš”.<br/>ë‹¤ë§Œ ì›ë³¸ ì´ë¯¸ì§€ê°€ ì˜¬ë¼ê°€ì•¼ í•¨ìœ¼ë¡œ ì´ë¯¸ì§€ ì—…ë¡œë“œ í• ë•Œ ë¶€í•˜ê°€ ê±¸ë¦´ ìˆ˜ ìˆìœ¼ë©°, ì„œë²„ìš©ëŸ‰ì´ ë” ë¹¨ë¦¬ ì°¨ëŠ” ë‹¨ì ì´ ìˆì–´ìš”.<br/>html ë‹¨ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì„œ ë¸Œë¼ìš°ì €ì—ì„œ ì œê³µì´ ì•ˆë˜ëŠ” ì¼€ì´ìŠ¤ë¥¼ ì˜ˆë°©í•´ìš”.',
          contents: `<picture>
  <!-- AVIF -->
  <source :srcset="item.contents + '.avif'" type="image/avif">
  <!-- WebP -->
  <source :srcset="item.contents + '.webp'" type="image/webp">
  <!-- JPG fallback -->
  <img :src="item.contents + '.jpg'" alt="ë°ì´í„° ë¹„êµ" style="width: 100%; height: auto;">
</picture>`,
        },
        { 
          laguageType: 'javascript',
          description: 'Javaë‹¨ì—ì„œ íŒŒì¼ì´ ì—…ë¡œë“œ ë˜ëŠ” ì‹œì ì— ë¹„ë™ê¸°ë¡œ webp, avif í¬ë§·ìœ¼ë¡œ ë³€í™˜ì„ ì‹œì¼œì¤˜ìš”.<br/>ì € ê°™ì€ ê²½ìš° windows os(local)ì— webp, avif ì‹¤í–‰íŒŒì¼ì„ ì„¤ì¹˜í•´ì„œ êµ¬ë™í–ˆì–´ìš”.',
          contents: `    private void convertToOptimizedFormatsAsync(Path originalPath) {
        executor.submit(() -> {
            try {
                runCwebp(originalPath, getSiblingPath(originalPath, "webp"), 75);
                runAvifenc(originalPath, getSiblingPath(originalPath, "avif"));
            } catch (Exception e) {
                e.printStackTrace();
                // TODO: DB status ì—…ë°ì´íŠ¸ (FAILED)
            }
        });
    }

    private Path getSiblingPath(Path original, String newExt) {
        String fileName = original.getFileName().toString();
        int dot = fileName.lastIndexOf('.');
        String base = (dot == -1) ? fileName : fileName.substring(0, dot);
        return original.getParent().resolve(base + "." + newExt);
    }

    private void runCwebp(Path input, Path output, int quality) throws IOException, InterruptedException {
        List<String> cmd = List.of(
        		"cwebp", 
        		"-q", String.valueOf(quality), 
        		input.toString(), 
        		"-o", output.toString());
        runProcess(cmd);
    }

    private void runAvifenc(Path input, Path output) throws IOException, InterruptedException {
        List<String> cmd = List.of(
        		"avifenc", 
        		input.toString(), 
        		output.toString());
        runProcess(cmd);
    }

    private void runProcess(List<String> cmd) throws IOException, InterruptedException {
        ProcessBuilder pb = new ProcessBuilder(cmd);
        pb.redirectErrorStream(true);
        Process proc = pb.start();

        try (InputStream is = proc.getInputStream()) {
            String output = new String(is.readAllBytes(), StandardCharsets.UTF_8);
            int exit = proc.waitFor();
            if (exit != 0) {
                throw new RuntimeException("Command failed: " + String.join(" ", cmd) + "\n" + output);
            }
        }
    }`,
        },
        { 
          laguageType: 'image',
          description: 'ë³€í™˜í•œ ì‹¤ì œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¨ê±°ì˜ˆìš”. ë‹¤ë§Œ ë¸Œë¼ìš°ì € ì§€ì›ì´ ì•ˆëœë‹¤ë©´ ì›ë³¸ íŒŒì¼ì´ í‘œì‹œë  ê±°ì˜ˆìš”.',
          contents: 'http://localhost:8080/images/BEFORE/20250902/49664d4d-30c7-448b-8042-789f414042e5',
          isUrl: true
        },
      ],
    },
    { 
      headerContents: 'ì§€ì—°ë¡œë”©ì„ ê³ ë ¤í•´ ë³¼ ìˆ˜ ìˆì–´ìš”.', 
      haveContents: true,
      isAggregated: true,
      aggregateContents: [
        { 
          laguageType: 'components',
          description: 'ë¸Œë¼ìš°ì €ê°€ í•œë²ˆì— load í•˜ëŠ” ë¶€ë‹´ë„ ì¤„ì´ë©´ì„œ ì‚¬ìš©ìë„ ì¢‹ì€ ê²½í—˜ì„ ê°€ì§ˆ ìˆ˜ ìˆì–´ìš”.',
          contents: shallowRef(defineAsyncComponent(() => import(`@/components/ImageContainer.vue`)))
        },
      ],
    },
  ]
})
// const attachBefore = ref<attachSettingType>({
//   isSubmit: '',
//   taskClassCd: 'BEFORE',
//   taskKey: '1'
// })
// const attachAfter = ref<attachSettingType>({
//   isSubmit: '',
//   taskClassCd: 'AFTER',
//   taskKey: '2'
// })

/******************************
 * @Computed_ì„ ì–¸
 *******************************/

/******************************
 * @Watch_ì„ ì–¸
 *******************************/

/******************************
 * @Life_cycle_ì„ ì–¸
 *******************************/

/******************************
 * @Function_ì„ ì–¸
 * TODO function ì£¼ì„ ì‘ì„± (asdffunctionannotation ì‚¬ìš©)
 *  * arrow function ì‚¬ìš©í•´ë„ ë¬´ê´€
 *******************************/

/******************************
 * @Provide_ì„ ì–¸
 *  ! types í´ë”ì— type ëª…ì‹œ
 *******************************/
</script>